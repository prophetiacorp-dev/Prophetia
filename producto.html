<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Producto — PROPHETIA</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body data-page="pdp">
  <div id="header"></div>

 <main class="pdp">
  <div class="product-wrap container">
    <!-- Galería izquierda -->
    <section class="pdp-gallery">
      <div class="pdp-hero">
        <button class="g-prev" aria-label="Anterior">‹</button>
        <img id="pMain" alt="" />
        <button class="g-next" aria-label="Siguiente">›</button>
      </div>
      <div id="pThumbs" class="pdp-thumbs"></div>
    </section>

    <!-- Panel derecha -->
    <aside class="pdp-panel" id="pInfo">
      <nav class="pdp-breadcrumb" aria-label="breadcrumbs">
        <a href="index.html">Home</a> ·
        <a href="colecciones.html">Collections</a> ·
        <span id="pCrumb">Product</span>
      </nav>

      <h1 id="pTitle" class="pdp-title">Producto</h1>
      <p id="pShort" class="pdp-short"></p>

      <div class="pdp-purchase">
        <div class="pdp-price"><span id="pPrice">€0,00</span></div>

        <!-- Talla -->
        <div class="pdp-row">
          <button id="openSize" class="pdp-link">Talla</button>
          <span id="pSizeSel" class="pdp-meta muted">—</span>
        </div>

        <!-- Color -->
        <div class="pdp-row">
          <span class="pdp-label">Color</span>
          <div id="pColors" class="pdp-swatches"></div>
        </div>

        <!-- Envío -->
        <div class="pdp-row">
          <button class="pdp-link" data-acc="ship">Envíos y devoluciones</button>
        </div>

        <!-- CTA -->
        <form id="buyForm" class="pdp-buy">
          <input id="qty" type="number" min="1" value="1" />
          <button type="submit" class="btn-primary">Añadir a la cesta</button>
        </form>
      </div>

      <!-- Detalles expandibles -->
      <section class="pdp-accordions">
        <button class="pdp-acc" data-acc="details">
          <span>Todos los detalles</span><span class="acc-ico">+</span>
        </button>
        <div class="pdp-acc-panel" id="pDetails">
          <div id="pDesc" class="pdp-desc"></div>
          <dl class="pdp-specs" id="pSpecs"></dl>
        </div>

        <button class="pdp-acc" data-acc="ship">
          <span>Envíos y devoluciones</span><span class="acc-ico">+</span>
        </button>
        <div class="pdp-acc-panel" id="pShip">
          <ul class="muted">
            <li>Envío gratis en 2–7 días laborables</li>
            <li>Devoluciones online gratuitas en 14 días</li>
            <li>Cambio en tienda gratuito 30 días</li>
          </ul>
        </div>
      </section>
    </aside>
  </div>

  <!-- Modal Tallas -->
  <div id="sizeModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Selecciona talla">
    <div class="modal-card modal-wide">
      <button class="modal-close" data-close>✕</button>
      <h3>Selecciona tu talla</h3>
      <div id="sizeGrid" class="size-grid"></div>
      <div class="size-foot">
        <a class="pdp-link" href="#" id="sizeGuide">Guía de tallas</a>
      </div>
    </div>
  </div>
</main>



  <!-- Zoom PDP -->
  <div id="pdpZoom" class="lb hidden" aria-hidden="true" role="dialog">
    <div class="lb-backdrop" data-lb-close></div>
    <figure class="lb-figure">
      <img id="pdpZoomImg" class="lb-img" alt="">
      <button class="lb-close" id="pdpZoomClose" aria-label="Cerrar">&times;</button>
      <button class="lb-prev"  id="pdpZoomPrev"  aria-label="Anterior">‹</button>
      <button class="lb-next"  id="pdpZoomNext"  aria-label="Siguiente">›</button>
    </figure>
  </div>

  <div id="footer"></div>
    <script src="assets/js/header-init.js"></script>
  <script src="assets/js/script.js"></script>

  <script src="assets/js/script.js"></script>
  <script>
    (async function injectHF(){
      const H = await fetch('/assets/partials/header.html').then(r=>r.text());
      const F = await fetch('/assets/partials/footer.html').then(r=>r.text());
      document.getElementById('header').innerHTML = H;
      document.getElementById('footer').innerHTML = F;
      window.ppInitHeader && window.ppInitHeader();

      // Tabs simples (están fuera de tu JS principal)
      const root = document.querySelector('.pdp-tabs');
      if(root){
        const tabs = root.querySelectorAll('.tabs-head .tab');
        const panels = root.querySelectorAll('.tab-panel');
        tabs.forEach(t=>{
          t.addEventListener('click', ()=>{
            tabs.forEach(x=>x.classList.remove('active'));
            t.classList.add('active');
            const target = t.dataset.tab;
            panels.forEach(p=> p.classList.toggle('hidden', p.dataset.panel !== target));
          });
        });
      }
    })();
  </script>
    <script>
    (async function initPDP(){
      // 1) leer slug/id
      const params = new URLSearchParams(location.search);
      const slug = params.get('slug') || params.get('id');

      // 2) cargar catálogo
      const res = await fetch('assets/data/catalog.json', { cache:'no-store' });
      const data = await res.json();
      const items = Array.isArray(data) ? data : (data.items || []);
      const prod = items.find(p => (p.slug || p.id) === slug) || items[0];
      if(!prod){ console.warn('[PDP] Producto no encontrado'); return; }

      // 3) pintar textos básicos
      const $ = (sel)=>document.querySelector(sel);
      $('#pTitle').textContent = prod.title || 'Producto';
      $('#pPrice').textContent = (typeof prod.price==='number') ? window.ppCart.money(prod.price) : (prod.price || '—');
      $('#pShort').textContent = prod.short || (prod.collection || '');

      // migas
      $('#pCrumb').textContent = prod.title || 'Product';

      // 4) galería
      const images = prod.images && prod.images.length ? prod.images : ['assets/img/products/placeholder.jpg'];
      const main = $('#pMain');
      const thumbs = $('#pThumbs');
      let i = 0;
      function paint(i0){
        i = i0; main.src = images[i] || images[0];
      }
      paint(0);
      thumbs.innerHTML = images.map((src,idx)=>`<button class="pdp-thumb${idx===0?' is-active':''}" data-i="${idx}"><img src="${src}" alt=""></button>`).join('');
      thumbs.addEventListener('click', (e)=>{
        const b = e.target.closest('button[data-i]'); if(!b) return;
        thumbs.querySelectorAll('.pdp-thumb').forEach(x=>x.classList.remove('is-active'));
        b.classList.add('is-active');
        paint(+b.dataset.i);
      });
      // flechas
      document.querySelector('.g-prev')?.addEventListener('click', ()=> paint((i-1+images.length)%images.length));
      document.querySelector('.g-next')?.addEventListener('click', ()=> paint((i+1)%images.length));

      // 5) tallas y colores (opcionales)
      const sizes  = prod.sizes  || [];
      const colors = prod.colors || [];
      if (sizes.length){
        const grid = document.getElementById('sizeGrid');
        grid.innerHTML = sizes.map(s=>`<button class="size" data-size="${s}">${s}</button>`).join('');
        grid.addEventListener('click', (e)=>{
          const b = e.target.closest('[data-size]'); if(!b) return;
          grid.querySelectorAll('.size').forEach(x=>x.classList.remove('active'));
          b.classList.add('active');
          document.getElementById('pSizeSel').textContent = b.dataset.size;
        });
      }
      if (colors.length){
        const sw = document.getElementById('pColors');
        sw.innerHTML = colors.map(c=>`<button class="sw" data-color="${c}" title="${c}"></button>`).join('');
        sw.addEventListener('click', (e)=>{
          const b = e.target.closest('[data-color]'); if(!b) return;
          sw.querySelectorAll('.sw').forEach(x=>x.classList.remove('active'));
          b.classList.add('active');
        });
      }

      // 6) añadir al carrito
      document.getElementById('buyForm')?.addEventListener('submit', (e)=>{
        e.preventDefault();
        const qty   = Math.max(1, +document.getElementById('qty').value || 1);
        const size  = document.querySelector('#sizeGrid .size.active')?.dataset.size || '';
        const color = document.querySelector('#pColors .sw.active')?.dataset.color || '';
        window.ppAddToCart({
          id:   prod.slug || prod.id,
          title: prod.title,
          price: +prod.price || 0,
          img:   images[0],
          size, color, qty
        });
      });
    })();
  </script>

</body>
</html>
